<div class="container mt-4">
  <!-- Cabecera -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h6 class="fw-bold mb-0">Clientes / Crédito</h6>
    <button class="btn btn-primary shadow-sm" (click)="openModal()">
      <i class="fas fa-plus me-2"></i>Agregar Cliente
    </button>
  </div>

  <!-- Filtros -->
  <div class="card shadow-sm mb-4 rounded">
    <div class="card-body">
      <h6 class="text-secondary mb-3"><i class="fas fa-filter me-2"></i>Filtros</h6>
      <div class="row g-2 mb-3">
        <div class="col-md-2"><input class="form-control form-control-sm" placeholder="Código"
            [(ngModel)]="filtroCodigo" (input)="loadClientes()"></div>
        <div class="col-md-3"><input class="form-control form-control-sm" placeholder="Nombre"
            [(ngModel)]="filtroNombre" (input)="loadClientes()"></div>
        <div class="col-md-2"><input class="form-control form-control-sm" placeholder="DUI" [(ngModel)]="filtroDui"
            (input)="loadClientes()"></div>
        <div class="col-md-2"><input class="form-control form-control-sm" placeholder="NIT" [(ngModel)]="filtroNit"
            (input)="loadClientes()"></div>
        <div class="col-md-3"><input class="form-control form-control-sm" placeholder="Teléfono"
            [(ngModel)]="filtroTelefono" (input)="loadClientes()"></div>
      </div>

      <div class="d-flex justify-content-between align-items-center">
        <div class="btn-group" role="group">
          <button type="button" class="btn" [ngClass]="soloConCredito ? 'btn-success' : 'btn-outline-secondary'"
            (click)="soloConCredito = !soloConCredito; loadClientes()">
            <i class="fas fa-credit-card me-1"></i>
            Solo clientes con crédito
          </button>
        </div>

        <div>
          <span class="fw-bold">Total Crédito: </span>
          <span class="text-success">{{ totalCreditoGeneral | currency:'USD':'symbol':'1.2-2' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="card shadow-sm rounded">
    <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light sticky-top">
          <tr class="text-center">
            <th (click)="ordenarPor('id')" class="sortable">Código <i class="fas"
                [ngClass]="order==='id'?(asc?'fa-sort-up':'fa-sort-down'):'fa-sort'"></i></th>
            <th (click)="ordenarPor('nombre')" class="sortable">Nombre <i class="fas"
                [ngClass]="order==='nombre'?(asc?'fa-sort-up':'fa-sort-down'):'fa-sort'"></i></th>
            <th (click)="ordenarPor('dui')" class="sortable">DUI <i class="fas"
                [ngClass]="order==='dui'?(asc?'fa-sort-up':'fa-sort-down'):'fa-sort'"></i></th>
            <th (click)="ordenarPor('nit')" class="sortable">NIT <i class="fas"
                [ngClass]="order==='nit'?(asc?'fa-sort-up':'fa-sort-down'):'fa-sort'"></i></th>
            <th (click)="ordenarPor('telefono')" class="sortable">Teléfono <i class="fas"
                [ngClass]="order==='telefono'?(asc?'fa-sort-up':'fa-sort-down'):'fa-sort'"></i></th>
            <th>Total Crédito</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody class="text-center">
          <tr *ngFor="let data of clientes" [ngClass]="{'fila-credito': (data.totalCredito ?? 0) > 0}">
            <td>{{ data.id }}</td>
            <td>{{ data.nombre }}</td>
            <td>{{ data.dui }}</td>
            <td>{{ data.nit }}</td>
            <td>{{ data.telefono }}</td>
            <td>{{ data.totalCredito | currency:'USD':'symbol':'1.2-2' }}</td>
            <td>
              <div class="d-flex justify-content-center gap-2">
                <button class="btn btn-outline-primary btn-sm" title="Editar" (click)="editar(data)"><i
                    class="fas fa-pen"></i></button>
                <button class="btn btn-outline-danger btn-sm" title="Eliminar" (click)="eliminar(data)"><i
                    class="fas fa-trash-alt"></i></button>
                <button class="btn btn-outline-warning btn-sm" title="Ver crédito y registrar abono"
                  (click)="abrirDetalleCredito(data)">
                  <i class="fas fa-money-bill-wave"></i>
                </button>

              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginador -->
    <nav class="mt-3">
      <ul class="pagination justify-content-end mb-0">
        <li class="page-item disabled"><span class="page-link">Items por página</span></li>
        <li class="page-item disabled"><span class="page-link">Página {{ page + 1 }} de {{ totalPages.length }}</span>
        </li>
        <li class="page-item" [class.disabled]="page===0">
          <a class="page-link" style="cursor:pointer;" (click)="paginaAnterior()"><i class="fas fa-angle-left"></i></a>
        </li>
        <li class="page-item" [class.disabled]="page+1>=totalPages.length">
          <a class="page-link" style="cursor:pointer;" (click)="paginaSiguiente()"><i
              class="fas fa-angle-right"></i></a>
        </li>
      </ul>
    </nav>
  </div>
</div>