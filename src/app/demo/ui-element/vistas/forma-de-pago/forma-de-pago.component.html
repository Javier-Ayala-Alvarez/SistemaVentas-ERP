<!-- ================= HEADER ================= -->
<div class="modal-header bg-primary text-white">
  <h5 class="modal-title">
    <i class="fas fa-credit-card me-2"></i>
    Forma de Pago
  </h5>
  <button class="btn-close btn-close-white"
          (click)="activeModal.dismiss()"></button>
</div>

<!-- ================= BODY ================= -->
<div class="modal-body p-4">

  <!-- PASOS -->
  <div class="alert alert-info py-2 mb-4 small">
    <strong>1.</strong> Seleccione forma de pago
    <span class="mx-2">→</span>
    <strong>2.</strong> Ingrese monto
    <span class="mx-2">→</span>
    <strong>3.</strong> Confirme operación
  </div>

  <div class="row g-4">

    <!-- ================= FORMAS DE PAGO ================= -->
    <div class="col-md-5">
      <div class="card shadow-sm h-100">
        <div class="card-header fw-semibold">
          Métodos de Pago
        </div>

        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <tbody>
              <tr *ngFor="let forma of formaPago"
                  (click)="seleccionarFormaPago(forma)"
                  [class.selected]="formaSeleccionada?.id === forma.id"
                  class="cursor-pointer">
                <td>
                  <strong>{{ forma.nombre }}</strong>
                </td>
                <td class="text-end">
                  <i class="fas fa-check-circle text-primary"
                     *ngIf="formaSeleccionada?.id === forma.id"></i>
                </td>
              </tr>

              <tr *ngIf="formaPago?.length === 0">
                <td class="text-center text-muted py-4">
                  No hay formas de pago
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ================= MONTO ================= -->
    <div class="col-md-7">
      <div class="card shadow-sm h-100">
        <div class="card-header fw-semibold">
          Detalle de Pago
        </div>

        <div class="card-body">

          <!-- Monto -->
          <label class="fw-semibold mb-1">Monto</label>
          <div class="input-group mb-3">
            <span class="input-group-text">$</span>
            <input type="number"
                   class="form-control"
                   min="0.01"
                   step="0.01"
                   [(ngModel)]="formaPagoOperacion.total"
                   [disabled]="!formaSeleccionada"
                   placeholder="Ingrese monto">
            <button class="btn btn-primary"
                    (click)="guardar()"
                    [disabled]="!formaSeleccionada || !formaPagoOperacion.total">
              <i class="fas fa-plus"></i>
              Agregar
            </button>
          </div>

          <!-- ================= RESUMEN ================= -->
          <div class="border rounded p-3 bg-light">
            <div class="d-flex justify-content-between mb-1">
              <span>Total Venta</span>
              <strong>${{ totalVenta | number:'1.2-2' }}</strong>
            </div>
            <div class="d-flex justify-content-between mb-1">
              <span>Efectivo</span>
              <strong>${{ efectivo | number:'1.2-2' }}</strong>
            </div>
            <hr class="my-2">
            <div class="d-flex justify-content-between text-success fw-bold">
              <span>Cambio</span>
              <span>${{ cambio | number:'1.2-2' }}</span>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>

  <!-- ================= LISTA DE PAGOS ================= -->
  <div class="card shadow-sm mt-4">
    <div class="card-header fw-semibold">
      Pagos Agregados
    </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-secondary">
          <tr>
            <th>Forma de Pago</th>
            <th class="text-end">Monto</th>
            <th class="text-center" style="width: 60px;"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let forma of formaPagoOperacionList">
            <td>{{ forma.formasPago?.nombre }}</td>
            <td class="text-end">${{ forma.total | number:'1.2-2' }}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-outline-danger rounded-circle"
                      (click)="eliminarFormaPago(forma)">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>

          <tr *ngIf="formaPagoOperacionList?.length === 0">
            <td colspan="3" class="text-center text-muted py-3">
              No hay pagos agregados
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- ================= FOOTER ================= -->
<div class="modal-footer">
  <button class="btn btn-outline-secondary"
          (click)="activeModal.close()">
    Cancelar
  </button>
  <button class="btn btn-success"
          (click)="guardarOperacion()"
          [disabled]="formaPagoOperacionList?.length === 0">
    <i class="fas fa-save me-1"></i>
    Guardar Operación
  </button>
</div>

<!-- ================= ESTILOS ================= -->
<style>
tr.selected {
  background-color: #e9f5ff;
  border-left: 4px solid #0d6efd;
}

tr {
  transition: background-color .15s ease;
}

.cursor-pointer {
  cursor: pointer;
}

input:focus {
  box-shadow: 0 0 0 .15rem rgba(13,110,253,.25);
}
</style>
