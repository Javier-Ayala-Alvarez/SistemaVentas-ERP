<!-- ===================== -->
<!-- FILTROS / BUSCADOR -->
<!-- ===================== -->
<div class="container-fluid mt-3">
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <form class="row g-3 align-items-end">

        <!-- Nombre -->
        <div class="col-lg-3 col-md-6">
          <label class="form-label small text-muted">Producto</label>
          <div class="input-group">
            <span class="input-group-text bg-light">
              <i class="fas fa-search"></i>
            </span>
            <input
              class="form-control"
              [(ngModel)]="filtroNombre"
              name="filtroNombre"
              placeholder="Buscar por nombre"
              (input)="loadProducto()" />
          </div>
        </div>

        <!-- Descripción -->
        <div class="col-lg-3 col-md-6">
          <label class="form-label small text-muted">Descripción</label>
          <div class="input-group">
            <span class="input-group-text bg-light">
              <i class="fas fa-align-left"></i>
            </span>
            <input
              class="form-control"
              [(ngModel)]="filtroDescripcion"
              name="filtroDescripcion"
              placeholder="Buscar descripción"
              (input)="loadProducto()" />
          </div>
        </div>

        <!-- Categoría -->
        <div class="col-lg-3 col-md-6">
          <label class="form-label small text-muted">Categoría</label>
          <select
            class="form-select"
            [(ngModel)]="filtroCategoria"
            name="filtroCategoria"
            (change)="loadProducto()">
            <option [ngValue]="null">Todas las categorías</option>
            <option *ngFor="let dato of categorias" [ngValue]="dato.id">
              {{ dato.nombre }}
            </option>
          </select>
        </div>

        <!-- Acciones -->
        <div class="col-lg-3 col-md-6 d-flex gap-2">
          <button
            type="button"
            class="btn btn-primary w-100"
            (click)="loadProducto()">
            <i class="fas fa-filter me-1"></i> Filtrar
          </button>

          <button
            type="button"
            class="btn btn-outline-secondary"
            (click)="limpiarFiltros()">
            <i class="fas fa-eraser"></i>
          </button>
        </div>

      </form>
    </div>
  </div>
</div>

<!-- ===================== -->
<!-- TÍTULO PRECIOS COMPRA -->
<!-- ===================== -->
<div *ngIf="mostrarPreciosCompra" class="container mt-4">
  <h4 class="text-center fw-bold">Precios de compra</h4>
</div>

<!-- ===================== -->
<!-- TARJETAS DE PRODUCTOS -->
<!-- ===================== -->
<div *ngIf="!mostrarPreciosCompra" class="container-fluid mt-4">
  <div class="row g-4">

    <div
      class="col-xl-3 col-lg-4 col-md-6"
      *ngFor="let card of producto">

      <mat-card class="product-card h-100">

        <!-- Imagen -->
        <div class="product-image">
          <img
            *ngIf="!imagenError[card.id!]"
            [src]="imagenRuta + card.nombreImagen"
            (error)="imagenError[card.id!] = true"
            alt="Producto" />

          <div *ngIf="imagenError[card.id!]" class="image-fallback">
            <mat-icon>image_not_supported</mat-icon>
          </div>
        </div>

        <!-- Contenido -->
        <mat-card-content>
          <h6 class="fw-bold mb-1">{{ card.codigo }}</h6>
          <p class="mb-1">{{ card.nombre }}</p>
          <small class="text-muted">{{ card.descripcion }}</small>
        </mat-card-content>

        <!-- Acción -->
        <mat-card-actions class="justify-content-end">
          <button
            mat-stroked-button
            color="primary"
            (click)="loadUnidadProducto(card.id)">
            <i class="fas fa-tag me-1"></i>
            {{ preciosVisible[card.id!] ? 'Ocultar precios' : 'Ver precios' }}
          </button>
        </mat-card-actions>

        <!-- Precios -->
        <div *ngIf="preciosVisible[card.id!]" class="px-3 pb-3">
          <div
            class="d-flex justify-content-between small py-1"
            *ngFor="let precio of unidadesMedidaProducto[card.id!]">
            <span>{{ precio.unidadMedida?.descripcion }}</span>
            <strong>{{ precio.precio | currency }}</strong>
          </div>
        </div>

      </mat-card>
    </div>
  </div>
</div>

<!-- ===================== -->
<!-- TABLA PRECIOS COMPRA -->
<!-- ===================== -->
<div *ngIf="mostrarPreciosCompra" class="container-fluid mt-4">
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Producto</th>
          <th>Descripción</th>
          <th>Unidades y precios</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let card of producto">

          <td class="d-flex align-items-center gap-2">
            <img
              *ngIf="!imagenError[card.id!]"
              [src]="imagenRuta + card.nombreImagen"
              (error)="imagenError[card.id!] = true"
              style="width:50px;height:50px;object-fit:cover;border-radius:6px;" />

            <div *ngIf="imagenError[card.id!]" class="image-fallback-sm">
              <i class="fas fa-image"></i>
            </div>

            <span class="fw-semibold">{{ card.nombre }}</span>
          </td>

          <td>{{ card.descripcion }}</td>

          <td>
            <div
              class="d-flex justify-content-between"
              *ngFor="let precio of unidadesMedidaProducto[card.id!]">
              <span>{{ precio.unidadMedida?.descripcion }}</span>
              <strong>{{ precio.precioCompra | currency }}</strong>
            </div>
          </td>

        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ===================== -->
<!-- MENSAJE SIN RESULTADOS -->
<!-- ===================== -->
<div *ngIf="noHayProductos" class="container mt-4">
  <div class="alert alert-warning text-center shadow-sm">
    <i class="fas fa-exclamation-circle me-2"></i>
    No se encontraron productos
  </div>
</div>

<!-- ===================== -->
<!-- PAGINADOR -->
<!-- ===================== -->
<nav *ngIf="!noHayProductos" class="mt-4">
  <ul class="pagination justify-content-center align-items-center gap-2">

    <li class="page-item disabled">
      <span class="page-link">
        Página {{ page + 1 }} de {{ totalPages.length }}
      </span>
    </li>

    <li class="page-item" [class.disabled]="isFirst">
      <button class="page-link" (click)="paginaAnterior()">
        <i class="fas fa-angle-left"></i>
      </button>
    </li>

    <li class="page-item" [class.disabled]="isLast">
      <button class="page-link" (click)="paginaSiguiente()">
        <i class="fas fa-angle-right"></i>
      </button>
    </li>

  </ul>
</nav>
